<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„ç¢ºèªã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .page-bg {
            background-image: url('images/olive.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.92);
        }

        .verification-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-display {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .reservation-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body class="page-bg">
    <div class="container">
        <header>
            <h1>ğŸ” äºˆç´„ç¢ºèªã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>ãŠåå‰ã¨äºˆç´„ç•ªå·ã‚’å…¥åŠ›ã—ã¦äºˆç´„ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
        </header>

        <main>
            <section class="verification-section">
                <div class="verification-card">
                    <h2>ğŸ“ äºˆç´„ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ </h2>

                    <form id="verification-form">
                        <div class="form-group">
                            <label for="verification-name">ãŠåå‰ *</label>
                            <input type="text" id="verification-name" required placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ">
                        </div>

                        <div class="form-group">
                            <label for="verification-number">äºˆç´„ç•ªå· *</label>
                            <input type="number" id="verification-number" min="1" max="999" required
                                placeholder="ä¾‹: 123">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">ç¢ºèªã™ã‚‹</button>
                            <button type="button" onclick="resetVerificationForm()"
                                class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
                        </div>
                    </form>

                    <div id="result-display" class="result-display hidden"></div>
                    <div id="reservation-info" class="reservation-info hidden"></div>
                </div>
            </section>

            <section class="info-section">
                <div class="verification-card">
                    <h2>â„¹ï¸ ä½¿ç”¨æ–¹æ³•</h2>
                    <ul>
                        <li>äºˆç´„æ™‚ã«ç™ºè¡Œã•ã‚ŒãŸäºˆç´„ç•ªå·ï¼ˆ1-999ã®æ•°å­—ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</li>
                        <li>ãŠåå‰ã¨äºˆç´„ç•ªå·ãŒä¸€è‡´ã™ã‚‹å ´åˆã€äºˆç´„è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                        <li>æ­£ã—ã„æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹ã¨æˆåŠŸéŸ³ãŒé³´ã‚Šã¾ã™</li>
                        <li>é–“é•ã£ãŸæƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼éŸ³ãŒé³´ã‚Šã¾ã™</li>
                    </ul>
                </div>
            </section>

            <section class="info-section">
                <h2>ğŸ”— URLãƒªãƒ³ã‚¯</h2>
                <div id="page-links" class="verification-card"></div>
            </section>
        </main>

        <footer>
            <a href="index.html" class="back-link">â† ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        </footer>
    </div>

    <script>
        // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼ˆå®Ÿéš›ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ï¼‰
        const SUCCESS_SOUND = 'sounds/success.mp3';
        const ERROR_SOUND = 'sounds/error.mp3';

        // éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
        function playSound(soundFile) {
            try {
                const audio = new Audio(soundFile);
                audio.play().catch(e => {
                    console.log('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã‚·ã‚¹ãƒ†ãƒ éŸ³ã‚’ä½¿ç”¨
                    if (soundFile.includes('success')) {
                        // æˆåŠŸéŸ³ã®ä»£æ›¿ï¼ˆãƒ“ãƒ¼ãƒ—éŸ³ï¼‰
                        playBeep(800, 200);
                    } else {
                        // ã‚¨ãƒ©ãƒ¼éŸ³ã®ä»£æ›¿ï¼ˆä½ã„ãƒ“ãƒ¼ãƒ—éŸ³ï¼‰
                        playBeep(300, 500);
                    }
                });
            } catch (e) {
                console.log('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        // ãƒ“ãƒ¼ãƒ—éŸ³ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function playBeep(frequency, duration) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (e) {
                console.log('ãƒ“ãƒ¼ãƒ—éŸ³ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        // äºˆç´„ç¢ºèªå‡¦ç†
        async function verifyReservation(name, number) {
            try {
                const response = await fetch('api/reservations.php');
                const reservations = await response.json();

                // åå‰ã¨ç•ªå·ãŒä¸€è‡´ã™ã‚‹äºˆç´„ã‚’æ¤œç´¢
                const matchingReservation = reservations.find(r =>
                    r.name === name && r.reservationNumber === parseInt(number)
                );

                return matchingReservation;
            } catch (error) {
                console.error('äºˆç´„ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                throw new Error('äºˆç´„ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // äºˆç´„ã‚’èªè¨¼æ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯
        async function markReservationAsVerified(name, number) {
            try {
                const response = await fetch('api/reservations.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'verify',
                        name: name.trim(),
                        reservationNumber: parseInt(number)
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    console.error('èªè¨¼ãƒãƒ¼ã‚¯ã®æ›´æ–°ã«å¤±æ•—:', errorData);
                    throw new Error('èªè¨¼ãƒãƒ¼ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (errorData.error || response.statusText));
                }

                const result = await response.json();
                console.log('èªè¨¼ãƒãƒ¼ã‚¯æ›´æ–°æˆåŠŸ:', result);
                return result;
            } catch (error) {
                console.error('èªè¨¼ãƒãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }

        // çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayResult(isSuccess, reservation = null) {
            const resultDiv = document.getElementById('result-display');
            const infoDiv = document.getElementById('reservation-info');

            resultDiv.classList.remove('hidden');
            infoDiv.classList.remove('hidden');

            if (isSuccess && reservation) {
                resultDiv.className = 'result-display success';
                resultDiv.innerHTML = 'âœ… äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼';

                infoDiv.innerHTML = `
          <h3>ğŸ“‹ äºˆç´„è©³ç´°</h3>
          <p><strong>ãŠåå‰:</strong> ${reservation.name}</p>
          <p><strong>äºˆç´„ç•ªå·:</strong> ${reservation.reservationNumber}</p>
          <p><strong>ãƒ¡ãƒ‹ãƒ¥ãƒ¼:</strong> ${reservation.food}</p>
          <p><strong>äººæ•°:</strong> ${reservation.people}äºº</p>
          <p><strong>äºˆç´„æ—¥:</strong> ${reservation.date}</p>
          <p><strong>äºˆç´„æ™‚é–“:</strong> ${reservation.time}</p>
        `;

                playSound(SUCCESS_SOUND);
            } else {
                resultDiv.className = 'result-display error';
                resultDiv.innerHTML = 'âŒ äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ';

                infoDiv.innerHTML = `
          <p>ãŠåå‰ã¨äºˆç´„ç•ªå·ã‚’ç¢ºèªã—ã¦ã€å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
          <p>äºˆç´„ç•ªå·ã¯1-999ã®æ•°å­—ã§ã™ã€‚</p>
        `;

                playSound(ERROR_SOUND);
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        document.getElementById('verification-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('verification-name').value.trim();
            const number = document.getElementById('verification-number').value;

            if (!name || !number) {
                alert('ãŠåå‰ã¨äºˆç´„ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const reservation = await verifyReservation(name, number);
                if (reservation) {
                    // èªè¨¼æˆåŠŸæ™‚ã€äºˆç´„ã‚’èªè¨¼æ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯
                    try {
                        await markReservationAsVerified(name, number);
                    } catch (error) {
                        console.error('èªè¨¼ãƒãƒ¼ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚çµæœè¡¨ç¤ºã¯ç¶šè¡Œ
                    }
                }
                displayResult(!!reservation, reservation);
            } catch (error) {
                console.error('ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                alert('äºˆç´„ã®ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        });

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetVerificationForm() {
            document.getElementById('verification-form').reset();
            document.getElementById('result-display').classList.add('hidden');
            document.getElementById('reservation-info').classList.add('hidden');
        }

        // ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ã®è¡¨ç¤º
        function renderLinks() {
            const base = window.location.href.replace(/[^/]*$/, '');
            const pages = [
                { name: 'ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ (index.html)', file: 'index.html' },
                { name: 'äºˆç´„ã‚µã‚¤ãƒˆ (reservation.html)', file: 'reservation.html' },
                { name: 'ç®¡ç†è€…ã‚µã‚¤ãƒˆ (admin.html)', file: 'admin.html' },
                { name: 'é£Ÿå ‚å°‚ç”¨AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (ai-assistant-php.html)', file: 'ai-assistant-php.html' }
            ];
            const linksDiv = document.getElementById('page-links');
            if (!linksDiv) return;
            linksDiv.innerHTML = pages.map(p => {
                const url = base + p.file;
                return `<p><strong>${p.name}:</strong> <a href="${url}">${url}</a></p>`;
            }).join('');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function () {
            renderLinks();
        });
    </script>
</body>

</html>