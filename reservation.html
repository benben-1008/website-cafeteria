<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é£Ÿå ‚äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ½ï¸ é£Ÿå ‚äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </h1>
      <p>ãŠåå‰ã¨ã”å¸Œæœ›ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
    </header>

    <main>
      <section class="reservation-section">
        <div class="reservation-card">
          <h2>ğŸ“ äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h2>
          <form id="reservation-form">
            <div class="form-group">
              <label for="student-name">ãŠåå‰ *</label>
              <input type="text" id="student-name" required placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ">
            </div>

            <div class="form-group">
              <label for="food">ã”å¸Œæœ›ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ *</label>
              <select id="food" required></select>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">äºˆç´„ã‚’ç¢ºå®š</button>
              <button type="button" onclick="resetForm()" class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
          </form>
        </div>
      </section>
    </main>

    <footer>
      <a href="index.html" class="back-link">â† ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </footer>
  </div>

  <script>
    function loadMenuOptions() {
      const select = document.getElementById("food");
      const menus = JSON.parse(localStorage.getItem("menuItems") || "[]");
      select.innerHTML = "";

      if (menus.length === 0) {
        select.innerHTML = "<option>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</option>";
        select.disabled = true;
        return;
      }

      menus.forEach(menu => {
        const option = document.createElement("option");
        option.value = menu.name;
        option.textContent = menu.stock > 0 
          ? `${menu.name}ï¼ˆæ®‹ã‚Š${menu.stock}é£Ÿï¼‰`
          : `${menu.name}ï¼ˆå£²ã‚Šåˆ‡ã‚Œï¼‰`;
        option.disabled = menu.stock <= 0;
        select.appendChild(option);
      });
    }

    document.getElementById("reservation-form").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("student-name").value.trim();
      const food = document.getElementById("food").value;
      if (!name || !food) return alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

      const menus = JSON.parse(localStorage.getItem("menuItems") || "[]");
      const menu = menus.find(m => m.name === food);
      if (!menu || menu.stock <= 0) {
        alert("ã“ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å£²ã‚Šåˆ‡ã‚Œã§ã™ã€‚");
        return;
      }

      // äºˆç´„ç™»éŒ²
      const reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
      reservations.push({ name, food, createdAt: new Date().toISOString() });
      localStorage.setItem("reservations", JSON.stringify(reservations));

      // åœ¨åº«ã‚’æ¸›ã‚‰ã™
      menu.stock -= 1;
      localStorage.setItem("menuItems", JSON.stringify(menus));

      alert("äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
      document.getElementById("reservation-form").reset();
      loadMenuOptions();
    });

    function resetForm() {
      document.getElementById("reservation-form").reset();
    }

    function renderLinks() {
      const base = window.location.href.replace(/[^/]*$/, '');
      const container = document.createElement('section');
      container.className = 'info-section';
      container.innerHTML = `
        <h2>ğŸ”— URLãƒªãƒ³ã‚¯</h2>
        <div class="info-card">
          <p><strong>ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ (index.html):</strong> <a href="${base}index.html">${base}index.html</a></p>
          <p><strong>ç®¡ç†è€…ã‚µã‚¤ãƒˆ (admin.html):</strong> <a href="${base}admin.html">${base}admin.html</a></p>
          <p><strong>äºˆç´„ã‚µã‚¤ãƒˆ (reservation.html):</strong> <a href="${base}reservation.html">${base}reservation.html</a></p>
          <p><strong>é£Ÿå ‚å°‚ç”¨ChatGPT (chatgpt.html):</strong> <a href="${base}chatgpt.html">${base}chatgpt.html</a></p>
        </div>`;
      document.querySelector('main').appendChild(container);
    }

    window.onload = function() {
      loadMenuOptions();
      renderLinks();
    };
  </script>
</body>
</html>
