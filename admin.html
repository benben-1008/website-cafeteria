<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚ªãƒªãƒŸãƒ« - ç®¡ç†ã‚µã‚¤ãƒˆ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* èƒŒæ™¯ç”»åƒè¨­å®šï¼ˆoliveï¼‰ */
    .page-bg {
      background-image: url('images/olive.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* å¯èª­æ€§å‘ä¸Šã®ãŸã‚ã®åŠé€æ˜èƒŒæ™¯ */
    .container {
      background-color: rgba(255, 255, 255, 0.92);
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã®ç°¡å˜ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
      margin-top: 10px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
    }

    .calendar div {
      padding: 5px;
    }

    .holiday {
      background-color: #ffcccc;
      border-radius: 6px;
    }

    /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .tab-navigation {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      border-bottom: 2px solid #ddd;
      padding-bottom: 10px;
    }

    .tab-button {
      padding: 12px 24px;
      background-color: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
      border-bottom: none;
    }

    .tab-button:hover {
      background-color: #e9ecef;
    }

    .tab-button.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ */
    .accordion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.3s;
    }

    .accordion-header:hover {
      background-color: #e9ecef;
    }

    .accordion-header h3 {
      margin: 0;
      font-size: 18px;
    }

    .accordion-icon {
      font-size: 20px;
      transition: transform 0.3s;
    }

    .accordion-header.active .accordion-icon {
      transform: rotate(180deg);
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .accordion-content.active {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }

    .accordion-body {
      padding: 20px;
      background-color: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      margin-bottom: 10px;
    }

    /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body class="page-bg">
  <div class="container">
    <header>
      <h1>ğŸ”§ ã‚ªãƒªãƒŸãƒ«</h1>
      <p>ç®¡ç†ç”¨ã‚µã‚¤ãƒˆ</p>
    </header>

    <main>
      <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div class="tab-navigation">
        <button class="tab-button active" onclick="switchTab('basic', this)">âš™ï¸ åŸºæœ¬è¨­å®š</button>
        <button class="tab-button" onclick="switchTab('data', this)">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
        <button class="tab-button" onclick="switchTab('system', this)">ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</button>
        <button class="tab-button" onclick="switchTab('other', this)">ğŸ”— ãã®ä»–</button>
      </div>

      <!-- åŸºæœ¬è¨­å®šã‚¿ãƒ– -->
      <div id="tab-basic" class="tab-content active">
      <!-- ğŸ”¹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† -->
      <section class="admin-section">
        <div class="accordion-header active" onclick="toggleAccordion(this)">
          <h3>ğŸ± ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content active">
          <div class="accordion-body">
            <div class="grid-2">
              <div class="admin-card">
                <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </h3>
          <div class="form-group">
            <label for="menu-name">ãƒ¡ãƒ‹ãƒ¥ãƒ¼å:</label>
            <input type="text" id="menu-name" placeholder="ä¾‹: ã‚«ãƒ¬ãƒ¼" required>
          </div>
          <div class="form-group">
            <label for="menu-stock">æä¾›å¯èƒ½æ•°:</label>
            <input type="number" id="menu-stock" placeholder="ä¾‹: 30">
          </div>
          <div class="form-group">
            <label
              style="display: flex; align-items: center; font-weight: bold; color: #e74c3c; font-size: 16px; padding: 12px; background-color: #fff5f5; border: 2px solid #e74c3c; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
              <input type="checkbox" id="unlimited-stock" onchange="toggleStockInput()"
                style="margin-right: 12px; transform: scale(2.0); cursor: pointer;">
              â™¾ï¸ ç„¡åˆ¶é™ã§æä¾›ï¼ˆåœ¨åº«ç®¡ç†ãªã—ï¼‰
            </label>
          </div>
                <button onclick="addMenu()" class="btn btn-primary">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </button>
              </div>

              <div class="admin-card">
                <h3>ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</h3>
                <div style="margin-bottom:10px;">
                  <button onclick="resetMenuStocks()" class="btn btn-secondary">æ®‹æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                <div id="menu-list"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ”¹ ä¼‘æ¥­æ—¥è¨­å®š -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>ğŸ“… ä¼‘æ¥­æ—¥è¨­å®š</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="grid-2">
              <div class="admin-card">
                <h3>ä¼‘æ¥­æ—¥ã‚’è¿½åŠ </h3>
          <div class="form-group">
            <label for="holiday-date">æ—¥ä»˜:</label>
            <input type="date" id="holiday-date" required>
          </div>
          <div class="form-group">
            <label for="holiday-reason">ç†ç”±:</label>
            <input type="text" id="holiday-reason" placeholder="ä¾‹: è¨­å‚™ç‚¹æ¤œ" required>
          </div>
                <button onclick="addHoliday()" class="btn btn-primary">ä¼‘æ¥­æ—¥ã‚’è¿½åŠ </button>
              </div>

              <div class="admin-card">
                <h3>ğŸ—“ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</h3>
                <div id="calendar" class="calendar"></div>
              </div>
            </div>
            <div class="admin-card">
              <h3>ç¾åœ¨ã®ä¼‘æ¥­æ—¥ä¸€è¦§</h3>
              <div id="holidays-list" class="holidays-list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ”¹ å®šé£Ÿè¨­å®š -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>ğŸ½ï¸ å®šé£Ÿè¨­å®š</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="grid-2">
              <div class="admin-card">
                <h3>æ—¥åˆ¥å®šé£Ÿã‚’è¨­å®š</h3>
          <div class="form-group">
            <label for="daily-menu-date">æ—¥ä»˜:</label>
            <input type="date" id="daily-menu-date" required>
          </div>
          <div class="form-group">
            <label for="daily-menu-food">å®šé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼:</label>
            <input type="text" id="daily-menu-food" placeholder="ä¾‹: ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹ã€æ—¥æ›¿ã‚ã‚Šå®šé£Ÿ" required>
          </div>
                <button onclick="addDailyMenu()" class="btn btn-primary">å®šé£Ÿã‚’è¨­å®š</button>
              </div>

              <div class="admin-card">
                <h3>ç¾åœ¨ã®å®šé£Ÿè¨­å®šä¸€è¦§</h3>
                <div id="daily-menu-list"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ”¹ äºˆç´„æ™‚é–“è¨­å®š -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>â° äºˆç´„æ™‚é–“è¨­å®š</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="grid-2">
              <div class="admin-card">
                <h3>äºˆç´„å¯èƒ½æ™‚é–“ã‚’è¨­å®š</h3>
                <div class="form-group">
                  <label for="reservation-start-time">é–‹å§‹æ™‚é–“:</label>
                  <input type="time" id="reservation-start-time" required>
                </div>
                <div class="form-group">
                  <label for="reservation-end-time">çµ‚äº†æ™‚é–“:</label>
                  <input type="time" id="reservation-end-time" required>
                </div>
                <div class="form-group">
                  <label for="reservation-message">è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label>
                  <input type="text" id="reservation-message" placeholder="ä¾‹: äºˆç´„æ™‚é–“: 11:30-12:45">
                </div>
                <p style="color: #666; font-size: 14px; margin-top: -10px; margin-bottom: 10px;">
                  â€» äºˆç´„æ™‚é–“ã‚’è¨­å®šã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«æœ‰åŠ¹ã«ãªã‚Šã¾ã™
                </p>
                <button onclick="updateReservationTimes()" class="btn btn-primary">äºˆç´„æ™‚é–“ã‚’æ›´æ–°</button>
              </div>

              <div class="admin-card">
                <h3>ç¾åœ¨ã®äºˆç´„æ™‚é–“è¨­å®š</h3>
                <div id="reservation-times-display"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
      </div>

      <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
      <div id="tab-data" class="tab-content">
      <!-- ğŸ”¹ äºˆç´„ä¸€è¦§ -->
      <section class="admin-section">
        <div class="accordion-header active" onclick="toggleAccordion(this)">
          <h3>ğŸ“ äºˆç´„ä¸€è¦§</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content active">
          <div class="accordion-body">
            <div class="admin-card">
              <h3>äºˆç´„çŠ¶æ³</h3>
          <div style="margin-bottom:10px;">
            <button onclick="loadReservations()" class="btn btn-primary">äºˆç´„ä¸€è¦§ã‚’æ›´æ–°</button>
            <button onclick="resetReservations()" class="btn btn-danger">äºˆç´„ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
              <div id="reservations-list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ”¹ ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>â­ ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="admin-card">
              <h3>æŠ•ç¨¿ã•ã‚ŒãŸãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
              <div style="margin-bottom:10px;">
                <button onclick="loadReviews()" class="btn btn-primary">ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã‚’æ›´æ–°</button>
              </div>
              <div id="reviews-list"></div>
            </div>
          </div>
        </div>
      </section>
      </div>

      <!-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ã‚¿ãƒ– -->
      <div id="tab-system" class="tab-content">
      <!-- ğŸ”¹ æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆç®¡ç† -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>ğŸ”„ æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆç®¡ç†</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="admin-card">
              <h3>è‡ªå‹•ãƒªã‚»ãƒƒãƒˆè¨­å®š</h3>
          <div style="margin-bottom:10px;">
            <button onclick="performDailyReset()" class="btn btn-primary">æ‰‹å‹•ã§ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ</button>
            <button onclick="checkResetStatus()" class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆçŠ¶æ³ç¢ºèª</button>
          </div>
              <div id="reset-status"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ğŸ”¹ æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ -->
      <section class="admin-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          <h3>ğŸ“Š æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-body">
            <div class="admin-card">
              <h3>ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h3>
              <div class="form-group">
                <label for="report-year">å¹´:</label>
                <select id="report-year">
                  <option value="2024">2024å¹´</option>
                  <option value="2025" selected>2025å¹´</option>
                </select>
              </div>
              <div class="form-group">
                <label for="report-month">æœˆ:</label>
                <select id="report-month">
                  <option value="1">1æœˆ</option>
                  <option value="2">2æœˆ</option>
                  <option value="3">3æœˆ</option>
                  <option value="4">4æœˆ</option>
                  <option value="5">5æœˆ</option>
                  <option value="6">6æœˆ</option>
                  <option value="7">7æœˆ</option>
                  <option value="8">8æœˆ</option>
                  <option value="9">9æœˆ</option>
                  <option value="10">10æœˆ</option>
                  <option value="11">11æœˆ</option>
                  <option value="12">12æœˆ</option>
                </select>
              </div>
              <div style="margin-bottom:10px;">
                <button onclick="generateReport()" class="btn btn-primary">ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button onclick="downloadReport()" class="btn btn-success">Excelå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
              </div>
              <div id="report-display"></div>
            </div>
          </div>
        </div>
      </section>
      </div>

      <!-- ãã®ä»–ã‚¿ãƒ– -->
      <div id="tab-other" class="tab-content">
      <section class="admin-section">
        <div class="accordion-header active" onclick="toggleAccordion(this)">
          <h3>ğŸ”— URLãƒªãƒ³ã‚¯</h3>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content active">
          <div class="accordion-body">
            <div id="page-links" class="admin-card"></div>
          </div>
        </div>
      </section>
      </div>

    </main>

    <footer>
      <p>&copy; 2025 å­¦æ ¡é£Ÿå ‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
    </footer>
  </div>

  <script>
    // === API ãƒ˜ãƒ«ãƒ‘ãƒ¼ ===
    const API_BASE = 'api/';
    async function apiGet(path) {
      const res = await fetch(API_BASE + path, { cache: 'no-store' });
      if (!res.ok) throw new Error('GET failed: ' + path);
      return await res.json();
    }
    async function apiPost(path, data) {
      const res = await fetch(API_BASE + path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error('POST failed: ' + path);
      return await res.json();
    }
    // === ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† ===
    function toggleStockInput() {
      const stockInput = document.getElementById("menu-stock");
      const unlimitedCheckbox = document.getElementById("unlimited-stock");

      if (unlimitedCheckbox.checked) {
        stockInput.disabled = true;
        stockInput.value = "";
        stockInput.placeholder = "ç„¡åˆ¶é™";
      } else {
        stockInput.disabled = false;
        stockInput.placeholder = "ä¾‹: 30";
      }
    }

    async function loadMenus() {
      const list = document.getElementById("menu-list");
      list.innerHTML = "";
      let menus = await apiGet('menu.php');

      // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåœ¨åº«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è£œå®Œï¼ˆåˆå›ã®ã¿ï¼‰
      let needsSave = false;
      menus.forEach(m => {
        if (typeof m.initialStock !== 'number' || m.initialStock <= 0) {
          m.initialStock = m.stock;
          needsSave = true;
        }
      });
      if (needsSave) {
        await apiPost('menu.php', menus);
      }

      if (!menus || menus.length === 0) {
        list.innerHTML = "<p>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
        return;
      }

      menus.forEach((m, i) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        const stockDisplay = m.stock === -1 ? "ç„¡åˆ¶é™" : `${m.stock}é£Ÿ`;
        div.innerHTML = `
          <p>ğŸ± ${m.name}ã€€æ®‹ã‚Š: ${stockDisplay}</p>
          <div style="display: flex; gap: 5px;">
            <button onclick="editMenuStock(${i})" class="btn btn-secondary">æ®‹æ•°å¤‰æ›´</button>
            <button onclick="deleteMenu(${i})" class="btn btn-danger">å‰Šé™¤</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    async function addMenu() {
      const name = document.getElementById("menu-name").value.trim();
      const unlimitedCheckbox = document.getElementById("unlimited-stock");
      const stockInput = document.getElementById("menu-stock");

      if (!name) return alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

      let stock, initialStock;
      if (unlimitedCheckbox.checked) {
        stock = -1; // ç„¡åˆ¶é™ã‚’-1ã§è¡¨ç¾
        initialStock = -1;
      } else {
        stock = parseInt(stockInput.value);
        if (!stock || stock <= 0) return alert("æä¾›æ•°ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        initialStock = stock;
      }

      const menus = await apiGet('menu.php');
      menus.push({ name, stock, initialStock });
      await apiPost('menu.php', menus);

      document.getElementById("menu-name").value = "";
      document.getElementById("menu-stock").value = "";
      document.getElementById("unlimited-stock").checked = false;
      stockInput.disabled = false;
      stockInput.placeholder = "ä¾‹: 30";
      loadMenus();
    }

    async function editMenuStock(index) {
      const menus = await apiGet('menu.php');
      const menu = menus[index];

      const newStock = prompt(`${menu.name}ã®æ®‹æ•°ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨: ${menu.stock === -1 ? 'ç„¡åˆ¶é™' : menu.stock}ï¼‰`, menu.stock === -1 ? '' : menu.stock);

      if (newStock === null) return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«

      if (newStock === '' || newStock === 'ç„¡åˆ¶é™') {
        menu.stock = -1;
      } else {
        const stock = parseInt(newStock);
        if (isNaN(stock) || stock < 0) {
          alert('æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        menu.stock = stock;
      }

      await apiPost('menu.php', menus);
      loadMenus();
    }

    async function deleteMenu(index) {
      const menus = await apiGet('menu.php');
      menus.splice(index, 1);
      await apiPost('menu.php', menus);
      loadMenus();
    }

    // === ä¼‘æ¥­æ—¥ç®¡ç† ===
    async function addHoliday() {
      const date = document.getElementById("holiday-date").value;
      const reason = document.getElementById("holiday-reason").value.trim();
      if (!date || !reason) return alert("æ—¥ä»˜ã¨ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

      const holidays = await apiGet('holidays.php');
      holidays.push({ date, reason });
      await apiPost('holidays.php', holidays);

      document.getElementById("holiday-date").value = "";
      document.getElementById("holiday-reason").value = "";
      loadHolidays();
      renderCalendar();
    }

    async function loadHolidays() {
      const holidays = await apiGet('holidays.php');
      const list = document.getElementById("holidays-list");

      if (!holidays || holidays.length === 0) {
        list.innerHTML = "<p>ä¼‘æ¥­æ—¥ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
      const sortedHolidays = holidays.sort((a, b) => a.date.localeCompare(b.date));

      list.innerHTML = sortedHolidays.map((h, i) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <p>ğŸ“… ${h.date}ã€€ğŸ“ ${h.reason}</p>
          <button onclick="deleteHoliday(${i})" class="btn btn-danger">å‰Šé™¤</button>
        `;
        return div.outerHTML;
      }).join('');
    }

    async function deleteHoliday(index) {
      if (!confirm('ã“ã®ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      const holidays = await apiGet('holidays.php');
      holidays.splice(index, 1);
      await apiPost('holidays.php', holidays);

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†æç”»ã—ã¦ã‹ã‚‰ä¼‘æ¥­æ—¥ä¸€è¦§ã‚’æ›´æ–°
      await renderCalendar();
      loadHolidays();
    }

    // === ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º ===
    async function renderCalendar() {
      const calendar = document.getElementById("calendar");
      const holidays = await apiGet('holidays.php');
      const dailyMenus = await apiGet('daily-menu.php');
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth(); // 0å§‹ã¾ã‚Š

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startWeekday = firstDay.getDay();

      calendar.innerHTML = "";

      // æ›œæ—¥
      ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"].forEach(d => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${d}</strong>`;
        calendar.appendChild(div);
      });

      // ç©ºæ¬„
      for (let i = 0; i < startWeekday; i++) {
        const blank = document.createElement("div");
        calendar.appendChild(blank);
      }

      // æ—¥ä»˜
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const div = document.createElement("div");
        const holiday = holidays.find(h => h.date === dateStr);
        const dailyMenu = dailyMenus.find(m => m.date === dateStr);
        const isHoliday = !!holiday;
        div.textContent = day;
        if (isHoliday) {
          div.classList.add("holiday");
        } else if (dailyMenu) {
          div.innerHTML = `${day}<br><small>${dailyMenu.food}</small>`;
        }
        calendar.appendChild(div);
      }
    }

    // === å®šé£Ÿè¨­å®š ===
    async function addDailyMenu() {
      const date = document.getElementById("daily-menu-date").value;
      const food = document.getElementById("daily-menu-food").value;
      if (!date || !food) return alert("æ—¥ä»˜ã¨å®šé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");

      const dailyMenus = await apiGet('daily-menu.php');

      // åŒã˜æ—¥ä»˜ã®è¨­å®šãŒã‚ã‚‹å ´åˆã¯æ›´æ–°ã€ãªã‘ã‚Œã°è¿½åŠ 
      const existingIndex = dailyMenus.findIndex(m => m.date === date);
      if (existingIndex >= 0) {
        dailyMenus[existingIndex].food = food;
      } else {
        dailyMenus.push({ date, food });
      }

      await apiPost('daily-menu.php', dailyMenus);

      document.getElementById("daily-menu-date").value = "";
      document.getElementById("daily-menu-food").value = "";
      loadDailyMenus();
      renderCalendar();
    }

    async function loadDailyMenus() {
      const dailyMenus = await apiGet('daily-menu.php');
      const list = document.getElementById("daily-menu-list");

      if (!dailyMenus || dailyMenus.length === 0) {
        list.innerHTML = "<p>å®šé£Ÿè¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
      const sortedMenus = dailyMenus.sort((a, b) => a.date.localeCompare(b.date));

      list.innerHTML = sortedMenus.map(m => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <p>ğŸ“… ${m.date}ã€€ğŸ½ï¸ ${m.food}</p>
          <button onclick="deleteDailyMenu('${m.date}')" class="btn btn-danger">å‰Šé™¤</button>
        `;
        return div.outerHTML;
      }).join('');
    }

    async function deleteDailyMenu(date) {
      if (!confirm('ã“ã®å®šé£Ÿè¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      const dailyMenus = await apiGet('daily-menu.php');
      const filtered = dailyMenus.filter(m => m.date !== date);
      await apiPost('daily-menu.php', filtered);
      loadDailyMenus();
      renderCalendar();
    }

    // === äºˆç´„ä¸€è¦§ ===
    async function loadReservations() {
      const reservations = await apiGet('reservations.php');
      const list = document.getElementById("reservations-list");

      if (!reservations || reservations.length === 0) {
        list.innerHTML = "<p>äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      const grouped = {};
      reservations.forEach(r => {
        if (!grouped[r.food]) grouped[r.food] = [];
        grouped[r.food].push(r);
      });

      // å„ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§åå‰é †ã«ã‚½ãƒ¼ãƒˆ
      Object.keys(grouped).forEach(food => {
        grouped[food].sort((a, b) => a.name.localeCompare(b.name, 'ja'));
      });

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åé †ã«ã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤º
      const sortedFoods = Object.keys(grouped).sort();
      list.innerHTML = sortedFoods.map(food => {
        const reservationsForFood = grouped[food];
        const verifiedCount = reservationsForFood.filter(r => r.verified === true || r.verified === 'true').length;
        const totalCount = reservationsForFood.length;
        
        // å„äºˆç´„è€…ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»˜ãã§è¡¨ç¤º
        const peopleList = reservationsForFood.map(r => {
          // verifiedãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆtrueã€'true'ã€1ãªã©æ§˜ã€…ãªå½¢å¼ã«å¯¾å¿œï¼‰
          const isVerified = r.verified === true || r.verified === 'true' || r.verified === 1;
          const checkboxId = `verified-${r.id || r.name}-${r.reservationNumber || ''}`;
          return `
            <div style="display: flex; align-items: center; margin-bottom: 5px; padding: 5px; background-color: ${isVerified ? '#d4edda' : '#fff'}; border-radius: 4px; border: 1px solid ${isVerified ? '#c3e6cb' : '#ddd'};">
              <input type="checkbox" 
                     id="${checkboxId}" 
                     ${isVerified ? 'checked' : ''} 
                     disabled
                     style="margin-right: 10px; transform: scale(1.5); cursor: not-allowed; accent-color: #28a745;">
              <label for="${checkboxId}" style="margin: 0; cursor: default; flex: 1; color: ${isVerified ? '#155724' : '#333'};">
                ${r.name} ${r.reservationNumber ? `(ç•ªå·: ${r.reservationNumber})` : ''}
                ${isVerified ? ' âœ…' : ''}
              </label>
            </div>
          `;
        }).join('');
        
        return `
          <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <h3 style="margin: 0 0 8px 0; font-size: 18px; color: #333;">ğŸ½ï¸ ${food}</h3>
            <div style="margin-bottom: 8px;">
              ${peopleList}
            </div>
            <p style="margin: 0; font-size: 16px; font-weight: bold; color: #e74c3c;">
              ğŸ‘¥ ${totalCount}äºº 
              ${verifiedCount > 0 ? `<span style="color: #28a745;">âœ… èªè¨¼æ¸ˆã¿: ${verifiedCount}äºº</span>` : ''}
            </p>
          </div>
        `;
      }).join('');
    }

    // === äºˆç´„ãƒªã‚»ãƒƒãƒˆ ===
    async function resetReservations() {
      if (!confirm('æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ã¦ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      await apiPost('reservations.php', []);
      loadReservations();
      alert("å…¨ã¦ã®äºˆç´„ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
    }

    // === ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ ===
    async function loadReviews() {
      try {
        const reviews = await apiGet('reviews.php');
        const list = document.getElementById("reviews-list");

        if (!reviews || reviews.length === 0) {
          list.innerHTML = "<p>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
          return;
        }

        list.innerHTML = reviews.map(review => {
          const name = review.name && review.name.trim() ? review.name : 'åŒ¿å';
          const date = review.date || 'æ—¥ä»˜ä¸æ˜';
          const comment = review.comment || '';
          
          return `
            <div style="margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #f8f9fa;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                  <strong style="font-size: 16px; color: #333;">${escapeHtml(name)}</strong>
                  <span style="font-size: 14px; color: #666; margin-left: 10px;">${escapeHtml(date)}</span>
                </div>
                <button onclick="deleteReview(${review.id})" class="btn btn-danger" style="padding: 6px 12px; font-size: 14px;">å‰Šé™¤</button>
              </div>
              <div style="color: #555; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">${escapeHtml(comment)}</div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('ãƒ¬ãƒ“ãƒ¥ãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById("reviews-list").innerHTML = 
          '<p style="color: red;">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
      }
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
    function escapeHtml(text) {
      if (text === null || text === undefined) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤
    async function deleteReview(reviewId) {
      if (!confirm('ã“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      try {
        const response = await fetch('api/reviews.php', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id: reviewId })
        });

        if (!response.ok) {
          throw new Error('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

        alert('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        loadReviews();
      } catch (error) {
        console.error('ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // === æ®‹æ•°ãƒªã‚»ãƒƒãƒˆ ===
    async function resetMenuStocks() {
      if (!confirm('æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ®‹æ•°ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã€‚')) {
        return;
      }

      let menus = await apiGet('menu.php');

      if (menus.length === 0) {
        alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      // ğŸ”¹ initialStock ãŒå­˜åœ¨ã—ãªã„å¤ã„ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã®è£œå®Œ
      menus = menus.map(m => {
        // ã‚‚ã— initialStock ãŒç„¡ã‘ã‚Œã°ã€ç¾åœ¨ã® stock ã‚’åˆæœŸå€¤ã¨ã—ã¦ä¿å­˜
        if (typeof m.initialStock !== "number" || m.initialStock <= 0) {
          m.initialStock = m.stock;
        }
        // ãƒªã‚»ãƒƒãƒˆå‡¦ç†ï¼šæ®‹æ•°ã‚’åˆæœŸå€¤ã«æˆ»ã™ï¼ˆç„¡åˆ¶é™ã®å ´åˆã¯-1ã®ã¾ã¾ï¼‰
        m.stock = m.initialStock;
        return m;
      });

      await apiPost('menu.php', menus);

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å†èª­ã¿è¾¼ã¿
      loadMenus();

      alert("å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ®‹æ•°ã‚’åˆæœŸå€¤ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
    }


    // === äºˆç´„æ™‚é–“ç®¡ç† ===
    async function loadReservationTimes() {
      try {
        const times = await apiGet('reservation-times.php');
        const displayDiv = document.getElementById('reservation-times-display');

        if (times) {
          displayDiv.innerHTML = `
            <div style="padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
              <p><strong>â° äºˆç´„å¯èƒ½æ™‚é–“:</strong> ${times.startTime} - ${times.endTime}</p>
              <p><strong>ğŸ“ çŠ¶æ…‹:</strong> ${times.enabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}</p>
              <p><strong>ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${times.message}</p>
            </div>
          `;

          // ãƒ•ã‚©ãƒ¼ãƒ ã«ç¾åœ¨ã®å€¤ã‚’è¨­å®š
          document.getElementById('reservation-start-time').value = times.startTime;
          document.getElementById('reservation-end-time').value = times.endTime;
          document.getElementById('reservation-message').value = times.message;
        }
      } catch (error) {
        console.error('äºˆç´„æ™‚é–“è¨­å®šã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('reservation-times-display').innerHTML =
          '<p style="color: red;">äºˆç´„æ™‚é–“è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
      }
    }

    async function updateReservationTimes() {
      const startTime = document.getElementById('reservation-start-time').value;
      const endTime = document.getElementById('reservation-end-time').value;
      const message = document.getElementById('reservation-message').value.trim();

      if (!startTime || !endTime) {
        alert('é–‹å§‹æ™‚é–“ã¨çµ‚äº†æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      if (startTime >= endTime) {
        alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šæ—©ãè¨­å®šã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      try {
        const data = {
          startTime: startTime,
          endTime: endTime,
          enabled: true, // è¨­å®šã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«æœ‰åŠ¹
          message: message || `äºˆç´„æ™‚é–“: ${startTime}-${endTime}`
        };

        await apiPost('reservation-times.php', data);
        alert('äºˆç´„æ™‚é–“è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\näºˆç´„æ™‚é–“åˆ¶é™ãŒè‡ªå‹•çš„ã«æœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚');
        loadReservationTimes();
      } catch (error) {
        console.error('äºˆç´„æ™‚é–“è¨­å®šã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        alert('äºˆç´„æ™‚é–“è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // === æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆç®¡ç† ===
    async function performDailyReset() {
      if (!confirm('æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ®‹æ•°ã¨äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      try {
        const response = await fetch('api/daily-reset.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await response.json();

        if (result.success) {
          alert('æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
          checkResetStatus();
          loadMenus();
          loadReservations();
        } else {
          alert('ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        console.error('ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒªã‚»ãƒƒãƒˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    }

    async function checkResetStatus() {
      try {
        const response = await fetch('api/daily-reset.php');
        const status = await response.json();

        const statusDiv = document.getElementById('reset-status');
        statusDiv.innerHTML = `
          <div style="padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
            <p><strong>ğŸ“… ä»Šæ—¥ã®æ—¥ä»˜:</strong> ${status.today}</p>
            <p><strong>ğŸ”„ ãƒªã‚»ãƒƒãƒˆçŠ¶æ³:</strong> ${status.needsReset ? 'âŒ æœªå®Ÿè¡Œ' : 'âœ… å®Ÿè¡Œæ¸ˆã¿'}</p>
            <p><strong>â° æœ€çµ‚ãƒªã‚»ãƒƒãƒˆæ—¥:</strong> ${status.lastReset || 'ãªã—'}</p>
            <p><strong>ğŸ• æœ€çµ‚ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»:</strong> ${status.lastResetTime || 'ãªã—'}</p>
          </div>
        `;
      } catch (error) {
        console.error('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('reset-status').innerHTML =
          '<p style="color: red;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
      }
    }

    // === æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ ===
    async function generateReport() {
      const year = document.getElementById('report-year').value;
      const month = document.getElementById('report-month').value;

      try {
        const response = await fetch(`api/monthly-report.php?year=${year}&month=${month}`);
        const report = await response.json();

        displayReport(report);
      } catch (error) {
        console.error('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    function displayReport(report) {
      const reportDiv = document.getElementById('report-display');

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¥å£²ä¸Šã®ãƒˆãƒƒãƒ—5
      const topMenuItems = Object.entries(report.topMenu || {})
        .map(([menu, quantity]) => `<li>${menu}: ${quantity}å€‹</li>`)
        .join('');

      // æ—¥åˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿
      const dailyData = report.dailySales || [];
      const dailyTable = dailyData.length > 0 ? `
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <tr style="background-color: #f8f9fa;">
            <th style="border: 1px solid #ddd; padding: 8px;">æ—¥ä»˜</th>
            <th style="border: 1px solid #ddd; padding: 8px;">äºˆç´„æ•°</th>
            <th style="border: 1px solid #ddd; padding: 8px;">æ¥å®¢æ•°</th>
          </tr>
          ${dailyData.map(day => `
            <tr>
              <td style="border: 1px solid #ddd; padding: 8px;">${day.date}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${day.reservations}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${day.people}</td>
            </tr>
          `).join('')}
        </table>
      ` : '<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';

      reportDiv.innerHTML = `
        <div style="padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; margin-top: 15px;">
          <h3 style="color: #333; margin-top: 0;">ğŸ“Š ${report.year}å¹´${report.month}æœˆ æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ</h3>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <h4 style="margin: 0 0 5px 0; color: #666;">ç·å–¶æ¥­æ—¥æ•°</h4>
              <p style="font-size: 24px; font-weight: bold; color: #007bff; margin: 0;">${report.totalDays}æ—¥</p>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <h4 style="margin: 0 0 5px 0; color: #666;">ç·äºˆç´„æ•°</h4>
              <p style="font-size: 24px; font-weight: bold; color: #28a745; margin: 0;">${report.totalReservations}ä»¶</p>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <h4 style="margin: 0 0 5px 0; color: #666;">ç·æ¥å®¢æ•°</h4>
              <p style="font-size: 24px; font-weight: bold; color: #dc3545; margin: 0;">${report.totalPeople}äºº</p>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <h4 style="margin: 0 0 5px 0; color: #666;">1æ—¥å¹³å‡æ¥å®¢æ•°</h4>
              <p style="font-size: 24px; font-weight: bold; color: #ffc107; margin: 0;">${report.averageDailyPeople}äºº</p>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4>ğŸ† äººæ°—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ TOP5</h4>
            <ul>${topMenuItems}</ul>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4>ğŸ“… æ—¥åˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿</h4>
            ${dailyTable}
          </div>
          
          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
            <h4 style="margin-top: 0;">ğŸ“ˆ åˆ†æçµæœ</h4>
            <p><strong>æœ€ã‚‚å¿™ã—ã‹ã£ãŸæ—¥:</strong> ${report.busiestDay || 'ãƒ‡ãƒ¼ã‚¿ãªã—'}</p>
            <p><strong>æœ€ã‚‚å¿™ã—ã‹ã£ãŸæ™‚é–“å¸¯:</strong> ${report.busiestTimeSlot || 'ãƒ‡ãƒ¼ã‚¿ãªã—'}</p>
          </div>
        </div>
      `;
    }

    async function downloadReport() {
      const year = document.getElementById('report-year').value;
      const month = document.getElementById('report-month').value;

      try {
        const response = await fetch(`api/monthly-report.php?year=${year}&month=${month}&format=csv`);
        const csvData = await response.text();

        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `monthly_report_${year}_${month.toString().padStart(2, '0')}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        alert('ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
      } catch (error) {
        console.error('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // === ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ===
    function switchTab(tabName, buttonElement) {
      // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‹ã‚‰activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
      document.getElementById(`tab-${tabName}`).classList.add('active');
      
      // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      if (buttonElement) {
        buttonElement.classList.add('active');
      }
    }

    // === ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³åˆ‡ã‚Šæ›¿ãˆ ===
    function toggleAccordion(header) {
      const content = header.nextElementSibling;
      const isActive = content.classList.contains('active');
      
      // ã™ã¹ã¦ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‰ã˜ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šä»–ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ã„ãŸã¾ã¾ã«ã™ã‚‹å ´åˆã¯å‰Šé™¤ï¼‰
      // document.querySelectorAll('.accordion-content').forEach(acc => {
      //   acc.classList.remove('active');
      //   acc.previousElementSibling.classList.remove('active');
      // });
      
      if (isActive) {
        content.classList.remove('active');
        header.classList.remove('active');
      } else {
        content.classList.add('active');
        header.classList.add('active');
      }
    }

    // === èµ·å‹•æ™‚ ===
    function renderLinks() {
      const base = window.location.href.replace(/[^/]*$/, '');
      const pages = [
        { name: 'ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ (index.html)', file: 'index.html' },
        { name: 'ç®¡ç†è€…ã‚µã‚¤ãƒˆ (admin.html)', file: 'admin.html' },
        { name: 'äºˆç´„ã‚µã‚¤ãƒˆ (reservation.php)', file: 'reservation.php' },
        { name: 'äºˆç´„ç¢ºèªã‚·ã‚¹ãƒ†ãƒ  (verification.html)', file: 'verification.html' },
        { name: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ (review.html)', file: 'review.html' },
        { name: 'é£Ÿå ‚å°‚ç”¨AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (ai-assistant-php.html)', file: 'ai-assistant-php.html' }
      ];
      const linksDiv = document.getElementById('page-links');
      if (!linksDiv) return;
      linksDiv.innerHTML = pages.map(p => {
        const url = base + p.file;
        return `<p><strong>${p.name}:</strong> <a href="${url}">${url}</a></p>`;
      }).join('');
    }

    window.onload = function () {
      loadMenus();
      loadHolidays();
      loadDailyMenus();
      loadReservations();
      loadReviews();
      loadReservationTimes();
      renderCalendar();
      renderLinks();
      checkResetStatus();

      // ç¾åœ¨ã®æœˆã‚’é¸æŠ
      const currentMonth = new Date().getMonth() + 1;
      document.getElementById('report-month').value = currentMonth;

      // äºˆç´„ä¸€è¦§ã‚’30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
      setInterval(() => {
        loadReservations();
      }, 30000); // 30ç§’
      
      // ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã‚’60ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
      setInterval(() => {
        loadReviews();
      }, 60000); // 60ç§’
    };
  </script>
</body>

</html>