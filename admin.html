<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­¦æ ¡é£Ÿå ‚ - ç®¡ç†ã‚µã‚¤ãƒˆ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã®ç°¡å˜ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
      margin-top: 10px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
    }

    .calendar div {
      padding: 5px;
    }

    .holiday {
      background-color: #ffcccc;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>ğŸ”§ å­¦æ ¡é£Ÿå ‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
      <p>ç®¡ç†ç”¨ã‚µã‚¤ãƒˆ</p>
    </header>

    <main>

      <!-- ğŸ”¹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† -->
      <section class="admin-section">
        <h2>ğŸ± ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h2>
        <div class="admin-card">
          <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </h3>
          <div class="form-group">
            <label for="menu-name">ãƒ¡ãƒ‹ãƒ¥ãƒ¼å:</label>
            <input type="text" id="menu-name" placeholder="ä¾‹: ã‚«ãƒ¬ãƒ¼" required>
          </div>
          <div class="form-group">
            <label for="menu-stock">æä¾›å¯èƒ½æ•°:</label>
            <input type="number" id="menu-stock" placeholder="ä¾‹: 30">
          </div>
          <div class="form-group">
            <label
              style="display: flex; align-items: center; font-weight: bold; color: #e74c3c; font-size: 16px; padding: 12px; background-color: #fff5f5; border: 2px solid #e74c3c; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
              <input type="checkbox" id="unlimited-stock" onchange="toggleStockInput()"
                style="margin-right: 12px; transform: scale(2.0); cursor: pointer;">
              â™¾ï¸ ç„¡åˆ¶é™ã§æä¾›ï¼ˆåœ¨åº«ç®¡ç†ãªã—ï¼‰
            </label>
          </div>
          <button onclick="addMenu()" class="btn btn-primary">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </button>
        </div>

        <div class="admin-card">
          <h3>ç¾åœ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</h3>
          <div style="margin-bottom:10px;">
            <button onclick="resetMenuStocks()" class="btn btn-secondary">æ®‹æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <div id="menu-list"></div>
        </div>
      </section>

      <!-- ğŸ”¹ ä¼‘æ¥­æ—¥è¨­å®š -->
      <section class="admin-section">
        <h2>ğŸ“… ä¼‘æ¥­æ—¥è¨­å®š</h2>
        <div class="admin-card">
          <h3>ä¼‘æ¥­æ—¥ã‚’è¿½åŠ </h3>
          <div class="form-group">
            <label for="holiday-date">æ—¥ä»˜:</label>
            <input type="date" id="holiday-date" required>
          </div>
          <div class="form-group">
            <label for="holiday-reason">ç†ç”±:</label>
            <input type="text" id="holiday-reason" placeholder="ä¾‹: è¨­å‚™ç‚¹æ¤œ" required>
          </div>
          <button onclick="addHoliday()" class="btn btn-primary">ä¼‘æ¥­æ—¥ã‚’è¿½åŠ </button>
        </div>

        <div class="admin-card">
          <h3>ğŸ—“ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</h3>
          <div id="calendar" class="calendar"></div>
        </div>

        <div class="admin-card">
          <h3>ç¾åœ¨ã®ä¼‘æ¥­æ—¥ä¸€è¦§</h3>
          <div id="holidays-list" class="holidays-list"></div>
        </div>
      </section>

      <!-- ğŸ”¹ å®šé£Ÿè¨­å®š -->
      <section class="admin-section">
        <h2>ğŸ½ï¸ å®šé£Ÿè¨­å®š</h2>
        <div class="admin-card">
          <h3>æ—¥åˆ¥å®šé£Ÿã‚’è¨­å®š</h3>
          <div class="form-group">
            <label for="daily-menu-date">æ—¥ä»˜:</label>
            <input type="date" id="daily-menu-date" required>
          </div>
          <div class="form-group">
            <label for="daily-menu-food">å®šé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼:</label>
            <input type="text" id="daily-menu-food" placeholder="ä¾‹: ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹ã€æ—¥æ›¿ã‚ã‚Šå®šé£Ÿ" required>
          </div>
          <button onclick="addDailyMenu()" class="btn btn-primary">å®šé£Ÿã‚’è¨­å®š</button>
        </div>

        <div class="admin-card">
          <h3>ç¾åœ¨ã®å®šé£Ÿè¨­å®šä¸€è¦§</h3>
          <div id="daily-menu-list"></div>
        </div>
      </section>

      <!-- ğŸ”¹ äºˆç´„æ™‚é–“è¨­å®š -->
      <section class="admin-section">
        <h2>â° äºˆç´„æ™‚é–“è¨­å®š</h2>
        <div class="admin-card">
          <h3>äºˆç´„å¯èƒ½æ™‚é–“ã‚’è¨­å®š</h3>
          <div class="form-group">
            <label for="reservation-start-time">é–‹å§‹æ™‚é–“:</label>
            <input type="time" id="reservation-start-time" required>
          </div>
          <div class="form-group">
            <label for="reservation-end-time">çµ‚äº†æ™‚é–“:</label>
            <input type="time" id="reservation-end-time" required>
          </div>
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="reservation-enabled" checked> äºˆç´„æ™‚é–“åˆ¶é™ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            </label>
          </div>
          <div class="form-group">
            <label for="reservation-message">è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label>
            <input type="text" id="reservation-message" placeholder="ä¾‹: äºˆç´„æ™‚é–“: 11:30-12:45">
          </div>
          <button onclick="updateReservationTimes()" class="btn btn-primary">äºˆç´„æ™‚é–“ã‚’æ›´æ–°</button>
        </div>

        <div class="admin-card">
          <h3>ç¾åœ¨ã®äºˆç´„æ™‚é–“è¨­å®š</h3>
          <div id="reservation-times-display"></div>
        </div>
      </section>

      <!-- ğŸ”¹ äºˆç´„ä¸€è¦§ -->
      <section class="admin-section">
        <h2>ğŸ“ äºˆç´„ä¸€è¦§</h2>
        <div class="admin-card">
          <h3>äºˆç´„çŠ¶æ³</h3>
          <div style="margin-bottom:10px;">
            <button onclick="resetReservations()" class="btn btn-danger">äºˆç´„ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <div id="reservations-list"></div>
        </div>
      </section>

      <section class="admin-section">
        <h2>ğŸ”— URLãƒªãƒ³ã‚¯</h2>
        <div id="page-links" class="admin-card"></div>
      </section>

    </main>

    <footer>
      <p>&copy; 2025 å­¦æ ¡é£Ÿå ‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
    </footer>
  </div>

  <script>
    // === API ãƒ˜ãƒ«ãƒ‘ãƒ¼ ===
    const API_BASE = 'api/';
    async function apiGet(path) {
      const res = await fetch(API_BASE + path, { cache: 'no-store' });
      if (!res.ok) throw new Error('GET failed: ' + path);
      return await res.json();
    }
    async function apiPost(path, data) {
      const res = await fetch(API_BASE + path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!res.ok) throw new Error('POST failed: ' + path);
      return await res.json();
    }
    // === ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† ===
    function toggleStockInput() {
      const stockInput = document.getElementById("menu-stock");
      const unlimitedCheckbox = document.getElementById("unlimited-stock");

      if (unlimitedCheckbox.checked) {
        stockInput.disabled = true;
        stockInput.value = "";
        stockInput.placeholder = "ç„¡åˆ¶é™";
      } else {
        stockInput.disabled = false;
        stockInput.placeholder = "ä¾‹: 30";
      }
    }

    async function loadMenus() {
      const list = document.getElementById("menu-list");
      list.innerHTML = "";
      let menus = await apiGet('menu.php');

      // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåœ¨åº«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è£œå®Œï¼ˆåˆå›ã®ã¿ï¼‰
      let needsSave = false;
      menus.forEach(m => {
        if (typeof m.initialStock !== 'number' || m.initialStock <= 0) {
          m.initialStock = m.stock;
          needsSave = true;
        }
      });
      if (needsSave) {
        await apiPost('menu.php', menus);
      }

      if (!menus || menus.length === 0) {
        list.innerHTML = "<p>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
        return;
      }

      menus.forEach((m, i) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        const stockDisplay = m.stock === -1 ? "ç„¡åˆ¶é™" : `${m.stock}é£Ÿ`;
        div.innerHTML = `
          <p>ğŸ± ${m.name}ã€€æ®‹ã‚Š: ${stockDisplay}</p>
          <button onclick="deleteMenu(${i})" class="btn btn-danger">å‰Šé™¤</button>
        `;
        list.appendChild(div);
      });
    }

    async function addMenu() {
      const name = document.getElementById("menu-name").value.trim();
      const unlimitedCheckbox = document.getElementById("unlimited-stock");
      const stockInput = document.getElementById("menu-stock");

      if (!name) return alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

      let stock, initialStock;
      if (unlimitedCheckbox.checked) {
        stock = -1; // ç„¡åˆ¶é™ã‚’-1ã§è¡¨ç¾
        initialStock = -1;
      } else {
        stock = parseInt(stockInput.value);
        if (!stock || stock <= 0) return alert("æä¾›æ•°ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        initialStock = stock;
      }

      const menus = await apiGet('menu.php');
      menus.push({ name, stock, initialStock });
      await apiPost('menu.php', menus);

      document.getElementById("menu-name").value = "";
      document.getElementById("menu-stock").value = "";
      document.getElementById("unlimited-stock").checked = false;
      stockInput.disabled = false;
      stockInput.placeholder = "ä¾‹: 30";
      loadMenus();
    }

    async function deleteMenu(index) {
      const menus = await apiGet('menu.php');
      menus.splice(index, 1);
      await apiPost('menu.php', menus);
      loadMenus();
    }

    // === ä¼‘æ¥­æ—¥ç®¡ç† ===
    async function addHoliday() {
      const date = document.getElementById("holiday-date").value;
      const reason = document.getElementById("holiday-reason").value.trim();
      if (!date || !reason) return alert("æ—¥ä»˜ã¨ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

      const holidays = await apiGet('holidays.php');
      holidays.push({ date, reason });
      await apiPost('holidays.php', holidays);

      document.getElementById("holiday-date").value = "";
      document.getElementById("holiday-reason").value = "";
      loadHolidays();
      renderCalendar();
    }

    async function loadHolidays() {
      const holidays = await apiGet('holidays.php');
      const list = document.getElementById("holidays-list");

      if (!holidays || holidays.length === 0) {
        list.innerHTML = "<p>ä¼‘æ¥­æ—¥ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
      const sortedHolidays = holidays.sort((a, b) => a.date.localeCompare(b.date));

      list.innerHTML = sortedHolidays.map((h, i) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <p>ğŸ“… ${h.date}ã€€ğŸ“ ${h.reason}</p>
          <button onclick="deleteHoliday(${i})" class="btn btn-danger">å‰Šé™¤</button>
        `;
        return div.outerHTML;
      }).join('');
    }

    async function deleteHoliday(index) {
      if (!confirm('ã“ã®ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      const holidays = await apiGet('holidays.php');
      holidays.splice(index, 1);
      await apiPost('holidays.php', holidays);

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†æç”»ã—ã¦ã‹ã‚‰ä¼‘æ¥­æ—¥ä¸€è¦§ã‚’æ›´æ–°
      await renderCalendar();
      loadHolidays();
    }

    // === ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º ===
    async function renderCalendar() {
      const calendar = document.getElementById("calendar");
      const holidays = await apiGet('holidays.php');
      const dailyMenus = await apiGet('daily-menu.php');
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth(); // 0å§‹ã¾ã‚Š

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startWeekday = firstDay.getDay();

      calendar.innerHTML = "";

      // æ›œæ—¥
      ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"].forEach(d => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${d}</strong>`;
        calendar.appendChild(div);
      });

      // ç©ºæ¬„
      for (let i = 0; i < startWeekday; i++) {
        const blank = document.createElement("div");
        calendar.appendChild(blank);
      }

      // æ—¥ä»˜
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const div = document.createElement("div");
        const holiday = holidays.find(h => h.date === dateStr);
        const dailyMenu = dailyMenus.find(m => m.date === dateStr);
        const isHoliday = !!holiday;
        div.textContent = day;
        if (isHoliday) {
          div.classList.add("holiday");
        } else if (dailyMenu) {
          div.innerHTML = `${day}<br><small>${dailyMenu.food}</small>`;
        }
        calendar.appendChild(div);
      }
    }

    // === å®šé£Ÿè¨­å®š ===
    async function addDailyMenu() {
      const date = document.getElementById("daily-menu-date").value;
      const food = document.getElementById("daily-menu-food").value;
      if (!date || !food) return alert("æ—¥ä»˜ã¨å®šé£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");

      const dailyMenus = await apiGet('daily-menu.php');

      // åŒã˜æ—¥ä»˜ã®è¨­å®šãŒã‚ã‚‹å ´åˆã¯æ›´æ–°ã€ãªã‘ã‚Œã°è¿½åŠ 
      const existingIndex = dailyMenus.findIndex(m => m.date === date);
      if (existingIndex >= 0) {
        dailyMenus[existingIndex].food = food;
      } else {
        dailyMenus.push({ date, food });
      }

      await apiPost('daily-menu.php', dailyMenus);

      document.getElementById("daily-menu-date").value = "";
      document.getElementById("daily-menu-food").value = "";
      loadDailyMenus();
      renderCalendar();
    }

    async function loadDailyMenus() {
      const dailyMenus = await apiGet('daily-menu.php');
      const list = document.getElementById("daily-menu-list");

      if (!dailyMenus || dailyMenus.length === 0) {
        list.innerHTML = "<p>å®šé£Ÿè¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
      const sortedMenus = dailyMenus.sort((a, b) => a.date.localeCompare(b.date));

      list.innerHTML = sortedMenus.map(m => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <p>ğŸ“… ${m.date}ã€€ğŸ½ï¸ ${m.food}</p>
          <button onclick="deleteDailyMenu('${m.date}')" class="btn btn-danger">å‰Šé™¤</button>
        `;
        return div.outerHTML;
      }).join('');
    }

    async function deleteDailyMenu(date) {
      if (!confirm('ã“ã®å®šé£Ÿè¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

      const dailyMenus = await apiGet('daily-menu.php');
      const filtered = dailyMenus.filter(m => m.date !== date);
      await apiPost('daily-menu.php', filtered);
      loadDailyMenus();
      renderCalendar();
    }

    // === äºˆç´„ä¸€è¦§ ===
    async function loadReservations() {
      const reservations = await apiGet('reservations.php');
      const list = document.getElementById("reservations-list");

      if (!reservations || reservations.length === 0) {
        list.innerHTML = "<p>äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
        return;
      }

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€é‡è¤‡ã™ã‚‹åå‰ã‚’å‰Šé™¤
      const grouped = {};
      reservations.forEach(r => {
        if (!grouped[r.food]) grouped[r.food] = new Set();
        grouped[r.food].add(r.name);
      });

      // å„ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§åå‰é †ã«ã‚½ãƒ¼ãƒˆ
      Object.keys(grouped).forEach(food => {
        const uniqueNames = Array.from(grouped[food]).sort((a, b) => a.localeCompare(b, 'ja'));
        grouped[food] = uniqueNames;
      });

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åé †ã«ã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤º
      const sortedFoods = Object.keys(grouped).sort();
      list.innerHTML = sortedFoods.map(food => {
        const people = grouped[food].join('ã€');
        const count = grouped[food].length;
        return `
          <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <h3 style="margin: 0 0 8px 0; font-size: 18px; color: #333;">ğŸ½ï¸ ${food}</h3>
            <p style="margin: 0 0 5px 0; font-size: 16px;">${people}</p>
            <p style="margin: 0; font-size: 20px; font-weight: bold; color: #e74c3c;">ğŸ‘¥ ${count}äºº</p>
          </div>
        `;
      }).join('');
    }

    // === äºˆç´„ãƒªã‚»ãƒƒãƒˆ ===
    async function resetReservations() {
      if (!confirm('æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ã¦ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      await apiPost('reservations.php', []);
      loadReservations();
      alert("å…¨ã¦ã®äºˆç´„ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
    }

    // === æ®‹æ•°ãƒªã‚»ãƒƒãƒˆ ===
    async function resetMenuStocks() {
      if (!confirm('æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ®‹æ•°ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã€‚')) {
        return;
      }

      let menus = await apiGet('menu.php');

      if (menus.length === 0) {
        alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      // ğŸ”¹ initialStock ãŒå­˜åœ¨ã—ãªã„å¤ã„ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã®è£œå®Œ
      menus = menus.map(m => {
        // ã‚‚ã— initialStock ãŒç„¡ã‘ã‚Œã°ã€ç¾åœ¨ã® stock ã‚’åˆæœŸå€¤ã¨ã—ã¦ä¿å­˜
        if (typeof m.initialStock !== "number" || m.initialStock <= 0) {
          m.initialStock = m.stock;
        }
        // ãƒªã‚»ãƒƒãƒˆå‡¦ç†ï¼šæ®‹æ•°ã‚’åˆæœŸå€¤ã«æˆ»ã™ï¼ˆç„¡åˆ¶é™ã®å ´åˆã¯-1ã®ã¾ã¾ï¼‰
        m.stock = m.initialStock;
        return m;
      });

      await apiPost('menu.php', menus);

      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å†èª­ã¿è¾¼ã¿
      loadMenus();

      alert("å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ®‹æ•°ã‚’åˆæœŸå€¤ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
    }


    // === äºˆç´„æ™‚é–“ç®¡ç† ===
    async function loadReservationTimes() {
      try {
        const times = await apiGet('reservation-times.php');
        const displayDiv = document.getElementById('reservation-times-display');

        if (times) {
          displayDiv.innerHTML = `
            <div style="padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
              <p><strong>â° äºˆç´„å¯èƒ½æ™‚é–“:</strong> ${times.startTime} - ${times.endTime}</p>
              <p><strong>ğŸ“ çŠ¶æ…‹:</strong> ${times.enabled ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}</p>
              <p><strong>ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${times.message}</p>
            </div>
          `;

          // ãƒ•ã‚©ãƒ¼ãƒ ã«ç¾åœ¨ã®å€¤ã‚’è¨­å®š
          document.getElementById('reservation-start-time').value = times.startTime;
          document.getElementById('reservation-end-time').value = times.endTime;
          document.getElementById('reservation-enabled').checked = times.enabled;
          document.getElementById('reservation-message').value = times.message;
        }
      } catch (error) {
        console.error('äºˆç´„æ™‚é–“è¨­å®šã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('reservation-times-display').innerHTML =
          '<p style="color: red;">äºˆç´„æ™‚é–“è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
      }
    }

    async function updateReservationTimes() {
      const startTime = document.getElementById('reservation-start-time').value;
      const endTime = document.getElementById('reservation-end-time').value;
      const enabled = document.getElementById('reservation-enabled').checked;
      const message = document.getElementById('reservation-message').value.trim();

      if (!startTime || !endTime) {
        alert('é–‹å§‹æ™‚é–“ã¨çµ‚äº†æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      if (startTime >= endTime) {
        alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šæ—©ãè¨­å®šã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      try {
        const data = {
          startTime: startTime,
          endTime: endTime,
          enabled: enabled,
          message: message || `äºˆç´„æ™‚é–“: ${startTime}-${endTime}`
        };

        await apiPost('reservation-times.php', data);
        alert('äºˆç´„æ™‚é–“è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸï¼');
        loadReservationTimes();
      } catch (error) {
        console.error('äºˆç´„æ™‚é–“è¨­å®šã®æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        alert('äºˆç´„æ™‚é–“è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // === èµ·å‹•æ™‚ ===
    function renderLinks() {
      const base = window.location.href.replace(/[^/]*$/, '');
      const pages = [
        { name: 'ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ (index.html)', file: 'index.html' },
        { name: 'ç®¡ç†è€…ã‚µã‚¤ãƒˆ (admin.html)', file: 'admin.html' },
        { name: 'äºˆç´„ã‚µã‚¤ãƒˆ (reservation.html)', file: 'reservation.html' },
        { name: 'é£Ÿå ‚å°‚ç”¨AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (ai-assistant-php.html)', file: 'ai-assistant-php.html' }
      ];
      const linksDiv = document.getElementById('page-links');
      if (!linksDiv) return;
      linksDiv.innerHTML = pages.map(p => {
        const url = base + p.file;
        return `<p><strong>${p.name}:</strong> <a href="${url}">${url}</a></p>`;
      }).join('');
    }

    window.onload = function () {
      loadMenus();
      loadHolidays();
      loadDailyMenus();
      loadReservations();
      loadReservationTimes();
      renderCalendar();
      renderLinks();
    };
  </script>
</body>

</html>